
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>一个自动生成的iptables - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="可以拿来研究研究 咔咔对shell 对iptables都有点帮助哇#!/bin/sh## Generated iptables firewall script for the Linux 2.4 kernel# Script generated by Easy Firewall Generator &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoursite.com/old_post.before.2007/2005-04-11-e4b880e4b8aae887aae58aa8e7949fe68890e79a84iptables.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yoursite.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/categories/gfrog-ride">骑行笔记</a></li>
    <li><a href="/categories/linux">Linux</a></li>
    <li><a href="/categories/picture">美丽图片</a></li>
    <li><a href="/categories/twitter-backup">Tweets</a></li>
    <li><a href="/blog/archives">全部日志</a></li>
    <li><a href="http://about.me/gfrog">关于我</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">一个自动生成的iptables</h1>
    
    
      <p class="meta">
        








  


<time datetime="2005-04-11T17:57:26+08:00" pubdate data-updated="true">Apr 11<span>th</span>, 2005</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>可以拿来研究研究 咔咔<br></br>对shell 对iptables都有点帮助哇<br></br><br></br>#!/bin/sh<br></br>#<br></br># Generated iptables firewall script for the Linux 2.4 kernel<br></br># Script generated by Easy Firewall Generator for IPTables 1.15<br></br># copyright 2002 Timothy Scott Morizot<br></br># <br></br># Redhat chkconfig comments &ndash; firewall applied early,<br></br>#                             removed late<br></br># chkconfig: 2345 08 92<br></br># description: This script applies or removes iptables firewall rules<br></br># <br></br><br></br></p>

<pre><code># This generator is primarily designed for RedHat installations,&lt;br&gt;&lt;/br&gt;# although it should be adaptable for others.&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# It can be executed with the typical start and stop arguments.&lt;br&gt;&lt;/br&gt;# If used with stop, it will stop after flushing the firewall.&lt;br&gt;&lt;/br&gt;# The save and restore arguments will save or restore the rules&lt;br&gt;&lt;/br&gt;# from the /etc/sysconfig/iptables file.  The save and restore&lt;br&gt;&lt;/br&gt;# arguments are included to preserve compatibility with&lt;br&gt;&lt;/br&gt;# Redhat's init.d script (at least in 7.x) if you prefer to use it.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Redhat installation instructions&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# 1. Ensure that ipchains will not automatically start.&lt;br&gt;&lt;/br&gt;#    chkconfig --level 0123456 ipchains off&lt;br&gt;&lt;/br&gt;#    This will make sure that the ipchains init.d script&lt;br&gt;&lt;/br&gt;#    is not linked to an S file in any of the rc directories.&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# 2. Stop ipchains if it's running.&lt;br&gt;&lt;/br&gt;#    service ipchains stop&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# 3. Execute lsmod to see if the ipchains kernel module is still loaded.&lt;br&gt;&lt;/br&gt;#    If it is, use rmmod to unload it. -- rmmod ipchains&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# 4. Have the system link the iptables init.d startup script into run states&lt;br&gt;&lt;/br&gt;#    2, 3, and 5.&lt;br&gt;&lt;/br&gt;#    chkconfig --level 235 iptables on&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# 5. Save this script and execute it to load the ruleset from this file.&lt;br&gt;&lt;/br&gt;#    You may need to run the dos2unix command on it to remove carraige returns.&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# 6. To have it applied at startup, copy this script to&lt;br&gt;&lt;/br&gt;#    /etc/init.d/iptables.  It accepts stop, start, save, and restore&lt;br&gt;&lt;/br&gt;#    arguments.  (You may wish to save the existing one first.)&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# 7. For non-Redhat systems (or Redhat systems if you have a problem), you&lt;br&gt;&lt;/br&gt;#    may want to append the command to execute this script to rc.local.&lt;br&gt;&lt;/br&gt;#    rc.local is typically located in /etc and /etc/rc.d and is usually&lt;br&gt;&lt;/br&gt;#    the last thing executed on startup.  Simply add /path/to/script/script_name&lt;br&gt;&lt;/br&gt;#    on its own line in the rc.local file.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;# &lt;br&gt;&lt;/br&gt;# Local Settings&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# sysctl location.  If set, it will use sysctl to adjust the kernel parameters.&lt;br&gt;&lt;/br&gt;# If this is set to the empty string (or is unset), the use of sysctl&lt;br&gt;&lt;/br&gt;# is disabled.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;SYSCTL="/sbin/sysctl -w" &lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# To echo the value directly to the /proc file instead&lt;br&gt;&lt;/br&gt;# SYSCTL=""&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# IPTables Location - adjust if needed&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;IPT="/sbin/iptables"&lt;br&gt;&lt;/br&gt;IPTS="/sbin/iptables-save"&lt;br&gt;&lt;/br&gt;IPTR="/sbin/iptables-restore"&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Internet Interface&lt;br&gt;&lt;/br&gt;INET_IFACE="eth0"&lt;br&gt;&lt;/br&gt;INET_ADDRESS="202.XXX.XXX.XXX"&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Localhost Interface&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;LO_IFACE="lo"&lt;br&gt;&lt;/br&gt;LO_IP="127.0.0.1"&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Save and Restore arguments handled here&lt;br&gt;&lt;/br&gt;if [ "$1" = "save" ]&lt;br&gt;&lt;/br&gt;then&lt;br&gt;&lt;/br&gt;    echo -n "Saving firewall to /etc/sysconfig/iptables ... "&lt;br&gt;&lt;/br&gt;  $IPTS &gt; /etc/sysconfig/iptables&lt;br&gt;&lt;/br&gt;    echo "done"&lt;br&gt;&lt;/br&gt;    exit 0&lt;br&gt;&lt;/br&gt;elif [ "$1" = "restore" ]&lt;br&gt;&lt;/br&gt;then&lt;br&gt;&lt;/br&gt;  echo -n "Restoring firewall from /etc/sysconfig/iptables ... "&lt;br&gt;&lt;/br&gt; $IPTR &lt; /etc/sysconfig/iptables&lt;br&gt;&lt;/br&gt;    echo "done"&lt;br&gt;&lt;/br&gt;    exit 0&lt;br&gt;&lt;/br&gt;fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# Load Modules&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;echo "Loading kernel modules ..."&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# You should uncomment the line below and run it the first time just to&lt;br&gt;&lt;/br&gt;# ensure all kernel module dependencies are OK.  There is no need to run&lt;br&gt;&lt;/br&gt;# every time, however.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# /sbin/depmod -a&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Unless you have kernel module auto-loading disabled, you should not&lt;br&gt;&lt;/br&gt;# need to manually load each of these modules.  Other than ip_tables,&lt;br&gt;&lt;/br&gt;# ip_conntrack, and some of the optional modules, I've left these&lt;br&gt;&lt;/br&gt;# commented by default.  Uncomment if you have any problems or if&lt;br&gt;&lt;/br&gt;# you have disabled module autoload.  Note that some modules must&lt;br&gt;&lt;/br&gt;# be loaded by another kernel module.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# core netfilter module&lt;br&gt;&lt;/br&gt;/sbin/modprobe ip_tables&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# the stateful connection tracking module&lt;br&gt;&lt;/br&gt;/sbin/modprobe ip_conntrack&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# filter table module&lt;br&gt;&lt;/br&gt;# /sbin/modprobe iptable_filter&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# mangle table module&lt;br&gt;&lt;/br&gt;# /sbin/modprobe iptable_mangle&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# nat table module&lt;br&gt;&lt;/br&gt;# /sbin/modprobe iptable_nat&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# LOG target module&lt;br&gt;&lt;/br&gt;# /sbin/modprobe ipt_LOG&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This is used to limit the number of packets per sec/min/hr&lt;br&gt;&lt;/br&gt;# /sbin/modprobe ipt_limit&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# masquerade target module&lt;br&gt;&lt;/br&gt;# /sbin/modprobe ipt_MASQUERADE&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# filter using owner as part of the match&lt;br&gt;&lt;/br&gt;# /sbin/modprobe ipt_owner&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# REJECT target drops the packet and returns an ICMP response.&lt;br&gt;&lt;/br&gt;# The response is configurable.  By default, connection refused.&lt;br&gt;&lt;/br&gt;# /sbin/modprobe ipt_REJECT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This target allows packets to be marked in the mangle table&lt;br&gt;&lt;/br&gt;# /sbin/modprobe ipt_mark&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This target affects the TCP MSS&lt;br&gt;&lt;/br&gt;# /sbin/modprobe ipt_tcpmss&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This match allows multiple ports instead of a single port or range&lt;br&gt;&lt;/br&gt;# /sbin/modprobe multiport&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This match checks against the TCP flags&lt;br&gt;&lt;/br&gt;# /sbin/modprobe ipt_state&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This match catches packets with invalid flags&lt;br&gt;&lt;/br&gt;# /sbin/modprobe ipt_unclean&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# The ftp nat module is required for non-PASV ftp support&lt;br&gt;&lt;/br&gt;/sbin/modprobe ip_nat_ftp&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# the module for full ftp connection tracking&lt;br&gt;&lt;/br&gt;/sbin/modprobe ip_conntrack_ftp&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# the module for full irc connection tracking&lt;br&gt;&lt;/br&gt;/sbin/modprobe ip_conntrack_irc&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# Kernel Parameter Configuration&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# See http://ipsysctl-tutorial.frozentux.net/chunkyhtml/index.html&lt;br&gt;&lt;/br&gt;# for a detailed tutorial on sysctl and the various settings&lt;br&gt;&lt;/br&gt;# available.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Required to enable IPv4 forwarding.&lt;br&gt;&lt;/br&gt;# Redhat users can try setting FORWARD_IPV4 in /etc/sysconfig/network to true&lt;br&gt;&lt;/br&gt;# Alternatively, it can be set in /etc/sysctl.conf&lt;br&gt;&lt;/br&gt;#if [ "$SYSCTL" = "" ]&lt;br&gt;&lt;/br&gt;#then&lt;br&gt;&lt;/br&gt;#    echo "1" &gt; /proc/sys/net/ipv4/ip_forward&lt;br&gt;&lt;/br&gt;#else&lt;br&gt;&lt;/br&gt;#    $SYSCTL net.ipv4.ip_forward="1"&lt;br&gt;&lt;/br&gt;#fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This enables dynamic address hacking.&lt;br&gt;&lt;/br&gt;# This may help if you have a dynamic IP address (e.g. slip, ppp, dhcp).&lt;br&gt;&lt;/br&gt;#if [ "$SYSCTL" = "" ]&lt;br&gt;&lt;/br&gt;#then&lt;br&gt;&lt;/br&gt;#    echo "1" &gt; /proc/sys/net/ipv4/ip_dynaddr&lt;br&gt;&lt;/br&gt;#else&lt;br&gt;&lt;/br&gt;#    $SYSCTL net.ipv4.ip_dynaddr="1"&lt;br&gt;&lt;/br&gt;#fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This enables SYN flood protection.&lt;br&gt;&lt;/br&gt;# The SYN cookies activation allows your system to accept an unlimited&lt;br&gt;&lt;/br&gt;# number of TCP connections while still trying to give reasonable&lt;br&gt;&lt;/br&gt;# service during a denial of service attack.&lt;br&gt;&lt;/br&gt;if [ "$SYSCTL" = "" ]&lt;br&gt;&lt;/br&gt;then&lt;br&gt;&lt;/br&gt;    echo "1" &gt; /proc/sys/net/ipv4/tcp_syncookies&lt;br&gt;&lt;/br&gt;else&lt;br&gt;&lt;/br&gt;    $SYSCTL net.ipv4.tcp_syncookies="1"&lt;br&gt;&lt;/br&gt;fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This enables source validation by reversed path according to RFC1812.&lt;br&gt;&lt;/br&gt;# In other words, did the response packet originate from the same interface&lt;br&gt;&lt;/br&gt;# through which the source packet was sent?  It's recommended for single-homed&lt;br&gt;&lt;/br&gt;# systems and routers on stub networks.  Since those are the configurations&lt;br&gt;&lt;/br&gt;# this firewall is designed to support, I turn it on by default.&lt;br&gt;&lt;/br&gt;# Turn it off if you us
e multiple NICs connected to the same network.&lt;br&gt;&lt;/br&gt;if [ "$SYSCTL" = "" ]&lt;br&gt;&lt;/br&gt;then&lt;br&gt;&lt;/br&gt;    echo "1" &gt; /proc/sys/net/ipv4/conf/all/rp_filter&lt;br&gt;&lt;/br&gt;else&lt;br&gt;&lt;/br&gt;    $SYSCTL net.ipv4.conf.all.rp_filter="1"&lt;br&gt;&lt;/br&gt;fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This option allows a subnet to be firewalled with a single IP address.&lt;br&gt;&lt;/br&gt;# It's used to build a DMZ.  Since that's not a focus of this firewall&lt;br&gt;&lt;/br&gt;# script, it's not enabled by default, but is included for reference.&lt;br&gt;&lt;/br&gt;# See: http://www.sjdjweis.com/linux/proxyarp/ &lt;br&gt;&lt;/br&gt;#if [ "$SYSCTL" = "" ]&lt;br&gt;&lt;/br&gt;#then&lt;br&gt;&lt;/br&gt;#    echo "1" &gt; /proc/sys/net/ipv4/conf/all/proxy_arp&lt;br&gt;&lt;/br&gt;#else&lt;br&gt;&lt;/br&gt;#    $SYSCTL net.ipv4.conf.all.proxy_arp="1"&lt;br&gt;&lt;/br&gt;#fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# The following kernel settings were suggested by Alex Weeks. Thanks!&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This kernel parameter instructs the kernel to ignore all ICMP&lt;br&gt;&lt;/br&gt;# echo requests sent to the broadcast address.  This prevents&lt;br&gt;&lt;/br&gt;# a number of smurfs and similar DoS nasty attacks.&lt;br&gt;&lt;/br&gt;if [ "$SYSCTL" = "" ]&lt;br&gt;&lt;/br&gt;then&lt;br&gt;&lt;/br&gt;    echo "1" &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts&lt;br&gt;&lt;/br&gt;else&lt;br&gt;&lt;/br&gt;    $SYSCTL net.ipv4.icmp_echo_ignore_broadcasts="1"&lt;br&gt;&lt;/br&gt;fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This option can be used to accept or refuse source routed&lt;br&gt;&lt;/br&gt;# packets.  It is usually on by default, but is generally&lt;br&gt;&lt;/br&gt;# considered a security risk.  This option turns it off.&lt;br&gt;&lt;/br&gt;if [ "$SYSCTL" = "" ]&lt;br&gt;&lt;/br&gt;then&lt;br&gt;&lt;/br&gt;    echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_source_route&lt;br&gt;&lt;/br&gt;else&lt;br&gt;&lt;/br&gt;    $SYSCTL net.ipv4.conf.all.accept_source_route="0"&lt;br&gt;&lt;/br&gt;fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This option can disable ICMP redirects.  ICMP redirects&lt;br&gt;&lt;/br&gt;# are generally considered a security risk and shouldn't be&lt;br&gt;&lt;/br&gt;# needed by most systems using this generator.&lt;br&gt;&lt;/br&gt;#if [ "$SYSCTL" = "" ]&lt;br&gt;&lt;/br&gt;#then&lt;br&gt;&lt;/br&gt;#    echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_redirects&lt;br&gt;&lt;/br&gt;#else&lt;br&gt;&lt;/br&gt;#    $SYSCTL net.ipv4.conf.all.accept_redirects="0"&lt;br&gt;&lt;/br&gt;#fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# However, we'll ensure the secure_redirects option is on instead.&lt;br&gt;&lt;/br&gt;# This option accepts only from gateways in the default gateways list.&lt;br&gt;&lt;/br&gt;if [ "$SYSCTL" = "" ]&lt;br&gt;&lt;/br&gt;then&lt;br&gt;&lt;/br&gt;    echo "1" &gt; /proc/sys/net/ipv4/conf/all/secure_redirects&lt;br&gt;&lt;/br&gt;else&lt;br&gt;&lt;/br&gt;    $SYSCTL net.ipv4.conf.all.secure_redirects="1"&lt;br&gt;&lt;/br&gt;fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# This option logs packets from impossible addresses.&lt;br&gt;&lt;/br&gt;if [ "$SYSCTL" = "" ]&lt;br&gt;&lt;/br&gt;then&lt;br&gt;&lt;/br&gt;    echo "1" &gt; /proc/sys/net/ipv4/conf/all/log_martians&lt;br&gt;&lt;/br&gt;else&lt;br&gt;&lt;/br&gt;    $SYSCTL net.ipv4.conf.all.log_martians="1"&lt;br&gt;&lt;/br&gt;fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# Flush Any Existing Rules or Chains&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;echo "Flushing Tables ..."&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Reset Default Policies&lt;br&gt;&lt;/br&gt;$IPT -P INPUT ACCEPT&lt;br&gt;&lt;/br&gt;$IPT -P FORWARD ACCEPT&lt;br&gt;&lt;/br&gt;$IPT -P OUTPUT ACCEPT&lt;br&gt;&lt;/br&gt;$IPT -t nat -P PREROUTING ACCEPT&lt;br&gt;&lt;/br&gt;$IPT -t nat -P POSTROUTING ACCEPT&lt;br&gt;&lt;/br&gt;$IPT -t nat -P OUTPUT ACCEPT&lt;br&gt;&lt;/br&gt;$IPT -t mangle -P PREROUTING ACCEPT&lt;br&gt;&lt;/br&gt;$IPT -t mangle -P OUTPUT ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Flush all rules&lt;br&gt;&lt;/br&gt;$IPT -F&lt;br&gt;&lt;/br&gt;$IPT -t nat -F&lt;br&gt;&lt;/br&gt;$IPT -t mangle -F&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Erase all non-default chains&lt;br&gt;&lt;/br&gt;$IPT -X&lt;br&gt;&lt;/br&gt;$IPT -t nat -X&lt;br&gt;&lt;/br&gt;$IPT -t mangle -X&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;if [ "$1" = "stop" ]&lt;br&gt;&lt;/br&gt;then&lt;br&gt;&lt;/br&gt; echo "Firewall completely flushed!  Now running with no firewall."&lt;br&gt;&lt;/br&gt; exit 0&lt;br&gt;&lt;/br&gt;fi&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# Rules Configuration&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# Filter Table&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Set Policies&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$IPT -P INPUT Drop&lt;br&gt;&lt;/br&gt;$IPT -P OUTPUT Drop&lt;br&gt;&lt;/br&gt;$IPT -P FORWARD Drop&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# User-Specified Chains&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# Create user chains to reduce the number of rules each packet&lt;br&gt;&lt;/br&gt;# must traverse.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;echo "Create and populate custom rule chains ..."&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Create a chain to filter INVALID packets&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$IPT -N bad_packets&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Create another chain to filter bad tcp packets&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$IPT -N bad_tcp_packets&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Create separate chains for icmp, tcp (incoming and outgoing),&lt;br&gt;&lt;/br&gt;# and incoming udp packets.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$IPT -N icmp_packets&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Used for UDP packets inbound from the Internet&lt;br&gt;&lt;/br&gt;$IPT -N udp_inbound&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Used to block outbound UDP services from internal network&lt;br&gt;&lt;/br&gt;# Default to allow all&lt;br&gt;&lt;/br&gt;$IPT -N udp_outbound&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Used to allow inbound services if desired&lt;br&gt;&lt;/br&gt;# Default fail except for established sessions&lt;br&gt;&lt;/br&gt;$IPT -N tcp_inbound&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Used to block outbound services from internal network&lt;br&gt;&lt;/br&gt;# Default to allow all&lt;br&gt;&lt;/br&gt;$IPT -N tcp_outbound&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# Populate User Chains&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# bad_packets chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# Drop INVALID packets immediately&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$IPT -A bad_packets -p ALL -m state --state INVALID -j LOG &lt;br&gt;&lt;/br&gt;    --log-prefix "fp=bad_packets:1 a=Drop "&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$IPT -A bad_packets -p ALL -m state --state INVALID -j Drop&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Then check the tcp packets for additional problems&lt;br&gt;&lt;/br&gt;$IPT -A bad_packets -p tcp -j bad_tcp_packets&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# All good, so return&lt;br&gt;&lt;/br&gt;$IPT -A bad_packets -p ALL -j RETURN&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# bad_tcp_packets chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# All tcp packets will traverse this chain.&lt;br&gt;&lt;/br&gt;# Every new connection attempt should begin with&lt;br&gt;&lt;/br&gt;# a syn packet.  If it doesn't, it is likely a&lt;br&gt;&lt;/br&gt;# port scan.  This drops packets in state&lt;br&gt;&lt;/br&gt;# NEW that are not flagged as syn packets.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$IPT -A bad_tcp_packets -p tcp ! --syn -m state --state NEW -j LOG &lt;br&gt;&lt;/br&gt;    --log-prefix "fp=bad_tcp_packets:1 a=Drop "&lt;br&gt;&lt;/br&gt;$IPT -A bad_tcp_packets -p tcp ! --syn -m state --state NEW -j Drop&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# All good, so return&lt;br&gt;&lt;/br&gt;$IPT -A bad_tcp_packets -p tcp -j RETURN&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# icmp_packets chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# This chain is for inbound (from the Internet) icmp packets only.&lt;br&gt;&lt;/br&gt;# Type 8 (Echo Request) is not accepted by default&lt;br&gt;&lt;/br&gt;# Enable it if you want remote hosts to be able to reach you.&lt;br&gt;&lt;/br&gt;# 11 (Time Exceeded) is the only one accepted&lt;br&gt;&lt;/br&gt;# that would not already be covered by the established&lt;br&gt;&lt;/br&gt;# connection rule.  Applied to INPUT on the external interface.&lt;br&gt;&lt;/br&gt;# &lt;br&gt;&lt;/br&gt;# See: http://www.ee.siue.edu/~rwalden/networking/icmp.html&lt;br&gt;&lt;/br&gt;# for more info on ICMP types.&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# Note that the stateful settings allow replies to ICMP packets.&lt;br&gt;&lt;/br&gt;# These rules allow new packets of the specified types.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# ICMP packets should fit in a Layer 2 frame, thus they should&lt;br&gt;&lt;/br&gt;# never be fragmented.  Fragmented ICMP packets are a typical sign&lt;br&gt;&lt;/br&gt;# of a denial of service attack.&lt;br&gt;&lt;/br&gt;$IPT -A icmp_packets --fragment -p ICMP -j LOG &lt;br&gt;&lt;/br&gt;    --log-prefix "fp=icmp_packets:1 a=Drop "&lt;br&gt;&lt;/br&gt;$IPT -A icmp_packets --fragment -p ICMP -j Drop&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Echo - uncomment to allow your system to be pinged.&lt;br&gt;&lt;/br&gt;# Uncomment the LOG command if you also want to log PING attempts&lt;br&gt;&lt;/br&gt;# &lt;br&gt;&lt;/br&gt;# $IPT -A icmp_packets -p ICMP -s 0/0 --icmp-type 8 -j LOG &lt;br&gt;&lt;/br&gt;#    --log-prefix "fp=icmp_packets:2 a=ACCEPT "&lt;br&gt;&lt;/br&gt;# $IPT -A icmp_packets -p ICMP -s 0/0 --icmp-type 8 -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# By default, however, drop pings without logging. Blaster&lt;br&gt;&lt;/br&gt;# and other worms have infected systems blasting pings.&lt;br&gt;&lt;/br&gt;# Comment the line below if you want pings logged, but it&lt;br&gt;&lt;/br&gt;# will likely fill your logs.&lt;br&gt;&lt;/br&gt;$IPT -A icmp_packets -p ICMP -s 0/0 --icmp-type 8 -j Drop&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Time Exceeded&lt;br&gt;&lt;/br&gt;$IPT -A icmp_packets -p ICMP -s 0/0 --icmp-type 11 -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Not matched, so return so it will be logged&lt;br&gt;&lt;/br&gt;$IPT -A icmp_packets -p ICMP -j RETURN&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# TCP &amp; UDP&lt;br&gt;&lt;/br&gt;# Ident
ify ports at:&lt;br&gt;&lt;/br&gt;#    http://www.chebucto.ns.ca/~rakerman/port-table.html&lt;br&gt;&lt;/br&gt;#    http://www.iana.org/assignments/port-numbers&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# udp_inbound chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# This chain describes the inbound UDP packets it will accept.&lt;br&gt;&lt;/br&gt;# It's applied to INPUT on the external or Internet interface.&lt;br&gt;&lt;/br&gt;# Note that the stateful settings allow replies.&lt;br&gt;&lt;/br&gt;# These rules are for new requests.&lt;br&gt;&lt;/br&gt;# It drops netbios packets (windows) immediately without logging.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Drop netbios calls&lt;br&gt;&lt;/br&gt;# Please note that these rules do not really change the way the firewall&lt;br&gt;&lt;/br&gt;# treats netbios connections.  Connections from the localhost and&lt;br&gt;&lt;/br&gt;# internal interface (if one exists) are accepted by default.&lt;br&gt;&lt;/br&gt;# Responses from the Internet to requests initiated by or through&lt;br&gt;&lt;/br&gt;# the firewall are also accepted by default.  To get here, the&lt;br&gt;&lt;/br&gt;# packets would have to be part of a new request received by the&lt;br&gt;&lt;/br&gt;# Internet interface.  You would have to manually add rules to&lt;br&gt;&lt;/br&gt;# accept these.  I added these rules because some network connections,&lt;br&gt;&lt;/br&gt;# such as those via cable modems, tend to be filled with noise from&lt;br&gt;&lt;/br&gt;# unprotected Windows machines.  These rules drop those packets&lt;br&gt;&lt;/br&gt;# quickly and without logging them.  This prevents them from traversing&lt;br&gt;&lt;/br&gt;# the whole chain and keeps the log from getting cluttered with&lt;br&gt;&lt;/br&gt;# chatter from Windows systems.&lt;br&gt;&lt;/br&gt;$IPT -A udp_inbound -p UDP -s 0/0 --destination-port 137 -j Drop&lt;br&gt;&lt;/br&gt;$IPT -A udp_inbound -p UDP -s 0/0 --destination-port 138 -j Drop&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# User specified allowed UDP protocol&lt;br&gt;&lt;/br&gt;$IPT -A udp_inbound -p UDP -s 0/0 --destination-port 4000 -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Not matched, so return for logging&lt;br&gt;&lt;/br&gt;$IPT -A udp_inbound -p UDP -j RETURN&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# udp_outbound chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# This chain is used with a private network to prevent forwarding for&lt;br&gt;&lt;/br&gt;# UDP requests on specific protocols.  Applied to the FORWARD rule from&lt;br&gt;&lt;/br&gt;# the internal network.  Ends with an ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# No match, so ACCEPT&lt;br&gt;&lt;/br&gt;$IPT -A udp_outbound -p UDP -s 0/0 -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# tcp_inbound chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# This chain is used to allow inbound connections to the&lt;br&gt;&lt;/br&gt;# system/gateway.  Use with care.  It defaults to none.&lt;br&gt;&lt;/br&gt;# It's applied on INPUT from the external or Internet interface.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# sshd&lt;br&gt;&lt;/br&gt;$IPT -A tcp_inbound -p TCP -s 0/0 --destination-port 22 -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# ICQ File Transfers &amp; Other Advanced Features&lt;br&gt;&lt;/br&gt;# &lt;br&gt;&lt;/br&gt;# ICQ supports a number of options beyond simple instant messaging.&lt;br&gt;&lt;/br&gt;# For those to function, the instant messaging system must allow&lt;br&gt;&lt;/br&gt;# new connections initiated from remote systems. This option will&lt;br&gt;&lt;/br&gt;# open a specified port range on the firewalled system.  The ICQ client&lt;br&gt;&lt;/br&gt;# on the firewalled system must also be configured to use the specified&lt;br&gt;&lt;/br&gt;# port range.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$IPT -A tcp_inbound -p TCP -s 0/0 --destination-port 5000:5100 -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# MSN Messenger File Transfers&lt;br&gt;&lt;/br&gt;# &lt;br&gt;&lt;/br&gt;# Messenger supports file transfers.  For transfers initiated by&lt;br&gt;&lt;/br&gt;# remote systems to function, the system must allow&lt;br&gt;&lt;/br&gt;# new connections initiated from remote systems a specific port range.&lt;br&gt;&lt;/br&gt;# This option defaults to the port range 6891 through 6900.&lt;br&gt;&lt;/br&gt;# Unless the MSN Messenger client can be configured to specify any&lt;br&gt;&lt;/br&gt;# port range, don't change the default.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$IPT -A tcp_inbound -p TCP -s 0/0 --destination-port 6891:6900 -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# User specified allowed UDP protocol&lt;br&gt;&lt;/br&gt;$IPT -A tcp_inbound -p TCP -s 0/0 --destination-port 4000 -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Not matched, so return so it will be logged&lt;br&gt;&lt;/br&gt;$IPT -A tcp_inbound -p TCP -j RETURN&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# tcp_outbound chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# This chain is used with a private network to prevent forwarding for&lt;br&gt;&lt;/br&gt;# requests on specific protocols.  Applied to the FORWARD rule from&lt;br&gt;&lt;/br&gt;# the internal network.  Ends with an ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# No match, so ACCEPT&lt;br&gt;&lt;/br&gt;$IPT -A tcp_outbound -p TCP -s 0/0 -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# INPUT Chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;echo "Process INPUT chain ..."&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Allow all on localhost interface&lt;br&gt;&lt;/br&gt;$IPT -A INPUT -p ALL -i $LO_IFACE -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Drop bad packets&lt;br&gt;&lt;/br&gt;$IPT -A INPUT -p ALL -j bad_packets&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# DOCSIS compliant cable modems&lt;br&gt;&lt;/br&gt;# Some DOCSIS compliant cable modems send IGMP multicasts to find&lt;br&gt;&lt;/br&gt;# connected PCs.  The multicast packets have the destination address&lt;br&gt;&lt;/br&gt;# 224.0.0.1.  You can accept them.  If you choose to do so,&lt;br&gt;&lt;/br&gt;# Uncomment the rule to ACCEPT them and comment the rule to Drop&lt;br&gt;&lt;/br&gt;# them  The firewall will drop them here by default to avoid&lt;br&gt;&lt;/br&gt;# cluttering the log.  The firewall will drop all multicasts&lt;br&gt;&lt;/br&gt;# to the entire subnet (224.0.0.1) by default.  To only affect&lt;br&gt;&lt;/br&gt;# IGMP multicasts, change '-p ALL' to '-p 2'.  Of course,&lt;br&gt;&lt;/br&gt;# if they aren't accepted elsewhere, it will only ensure that&lt;br&gt;&lt;/br&gt;# multicasts on other protocols are logged.&lt;br&gt;&lt;/br&gt;# Drop them without logging.&lt;br&gt;&lt;/br&gt;$IPT -A INPUT -p ALL -d 224.0.0.1 -j Drop&lt;br&gt;&lt;/br&gt;# The rule to accept the packets.&lt;br&gt;&lt;/br&gt;# $IPT -A INPUT -p ALL -d 224.0.0.1 -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Inbound Internet Packet Rules&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Accept Established Connections&lt;br&gt;&lt;/br&gt;$IPT -A INPUT -p ALL -i $INET_IFACE -m state --state ESTABLISHED,RELATED &lt;br&gt;&lt;/br&gt;     -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Route the rest to the appropriate user chain&lt;br&gt;&lt;/br&gt;$IPT -A INPUT -p TCP -i $INET_IFACE -j tcp_inbound&lt;br&gt;&lt;/br&gt;$IPT -A INPUT -p UDP -i $INET_IFACE -j udp_inbound&lt;br&gt;&lt;/br&gt;$IPT -A INPUT -p ICMP -i $INET_IFACE -j icmp_packets&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Drop without logging broadcasts that get this far.&lt;br&gt;&lt;/br&gt;# Cuts down on log clutter.&lt;br&gt;&lt;/br&gt;# Comment this line if testing new rules that impact&lt;br&gt;&lt;/br&gt;# broadcast protocols.&lt;br&gt;&lt;/br&gt;$IPT -A INPUT -p ALL -d 255.255.255.255 -j Drop&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Log packets that still don't match&lt;br&gt;&lt;/br&gt;$IPT -A INPUT -j LOG --log-prefix "fp=INPUT:99 a=Drop "&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# FORWARD Chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;echo "Process FORWARD chain ..."&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Used if forwarding for a private network&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# OUTPUT Chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;echo "Process OUTPUT chain ..."&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Generally trust the firewall on output&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# However, invalid icmp packets need to be dropped&lt;br&gt;&lt;/br&gt;# to prevent a possible exploit.&lt;br&gt;&lt;/br&gt;$IPT -A OUTPUT -m state -p icmp --state INVALID -j Drop&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Localhost&lt;br&gt;&lt;/br&gt;$IPT -A OUTPUT -p ALL -s $LO_IP -j ACCEPT&lt;br&gt;&lt;/br&gt;$IPT -A OUTPUT -p ALL -o $LO_IFACE -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# To internet&lt;br&gt;&lt;/br&gt;$IPT -A OUTPUT -p ALL -o $INET_IFACE -j ACCEPT&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# Log packets that still don't match&lt;br&gt;&lt;/br&gt;$IPT -A OUTPUT -j LOG --log-prefix "fp=OUTPUT:99 a=Drop "&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# nat table&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# The nat table is where network address translation occurs if there&lt;br&gt;&lt;/br&gt;# is a private network.  If the gateway is connected to the Internet&lt;br&gt;&lt;/br&gt;# with a static IP, snat is used.  If the gateway has a dynamic address,&lt;br&gt;&lt;/br&gt;# masquerade must be used instead.  There is more overhead associated&lt;br&gt;&lt;/br&gt;# with masquerade, so snat is better when it can be used.&lt;br&gt;&lt;/br&gt;# The nat table has a builtin chain, PREROUTING, for dnat and redirects.&lt;br&gt;&lt;/br&gt;# Another, POSTROUTING, handles snat and masquerade.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;echo "Load rules for nat table ..."&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# PREROUTING chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# POSTROUTING chain&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;###############################################################################&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;# mangle table&lt;br&gt;&lt;/br&gt;#&lt;br&gt;&lt;/br&gt;##############################################################
#################&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;# The mangle table is used to alter packets.  It can alter or mangle them in&lt;br&gt;&lt;/br&gt;# several ways.  For the purposes of this generator, we only use its ability&lt;br&gt;&lt;/br&gt;# to alter the TTL in packets.  However, it can be used to set netfilter&lt;br&gt;&lt;/br&gt;# mark values on specific packets.  Those marks could then be used in another&lt;br&gt;&lt;/br&gt;# table like filter, to limit activities associated with a specific host, for&lt;br&gt;&lt;/br&gt;# instance.  The TOS target can be used to set the Type of Service field in&lt;br&gt;&lt;/br&gt;# the IP header.  Note that the TTL target might not be included in the&lt;br&gt;&lt;/br&gt;# distribution on your system.  If it is not and you require it, you will&lt;br&gt;&lt;/br&gt;# have to add it.  That may require that you build from source.&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;echo "Load rules for mangle table ..."
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      








  


<time datetime="2005-04-11T17:57:26+08:00" pubdate data-updated="true">Apr 11<span>th</span>, 2005</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/linux-linux/'>linux[Linux]</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://yoursite.com/old_post.before.2007/2005-04-11-e4b880e4b8aae887aae58aa8e7949fe68890e79a84iptables.html" data-via="" data-counturl="http://yoursite.com/old_post.before.2007/2005-04-11-e4b880e4b8aae887aae58aa8e7949fe68890e79a84iptables.html" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/01/2013-summary-and-2014-outlook/">2013年终总结及2014年新年目标</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/09/tour-of-qingdao-b/">青岛两日游（中）</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/09/tour-of-qingdao-a/">青岛两日游（上）</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/06/outing-jiming-dak-in-hebei/">探访鸡鸣驿</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/13/pic-of-dsic/">一张流：大连造船厂</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
